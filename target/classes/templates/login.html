<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <title data-i18n="login.title">로그인</title>
    <link rel="stylesheet" href="/resources/css/styles.css">
    <link rel="stylesheet" href="/resources/css/login.css">
</head>
<body>
    <div th:replace="common/header :: header"></div>

    <div class="login-page-wrapper">
        <div class="login-container">
            <h1 data-i18n="login.brand">HealnGo</h1>
            <p data-i18n="login.subtitle">간편하게 로그인하고 서비스를 이용하세요</p>

            <!-- 일반 로그인 폼 -->
            <form id="login-form" class="login-form">
                <div class="form-group">
                    <label for="email">이메일</label>
                    <input type="email" id="email" name="email" required>
                    <span class="error-message" id="email-error"></span>
                </div>

                <div class="form-group">
                    <label for="password">비밀번호</label>
                    <input type="password" id="password" name="password" required>
                    <span class="error-message" id="password-error"></span>
                </div>

                <div class="form-options">
                    <label class="remember-me">
                        <input type="checkbox" name="remember-me">
                        <span>로그인 상태 유지</span>
                    </label>
                    <a th:href="@{/forgot-password}" class="forgot-password">비밀번호 찾기</a>
                </div>

                <button type="submit" class="login-btn primary-btn">로그인</button>
            </form>

            <!-- 구분선 -->
            <div class="divider">
                <span>또는</span>
            </div>

            <!-- 카카오 로그인 -->
            <a th:href="${kakaoLoginUrl}" id="kakao-login-btn" class="login-btn kakao-btn">
                <img src="https://developers.kakao.com/assets/img/about/logos/kakaolink/kakaolink_btn_medium.png" alt="Kakao" class="kakao-icon" />
                <span data-i18n="login.kakao.button">카카오로 로그인</span>
            </a>

            <!-- 구글 로그인 -->
            <a th:href="${googleLoginUrl}" id="google-login-btn" class="login-btn google-btn">
                <img src="https://developers.google.com/identity/images/g-logo.png" alt="Google" class="google-icon" />
                <span data-i18n="login.google.button">구글로 로그인</span>
            </a>

            <!-- 회원가입 링크 -->
            <div class="signup-link">
                <p data-i18n="login.signup.text">아직 계정이 없으신가요?</p>
                <a th:href="@{/signup}" class="signup-btn user-signup-btn" data-i18n="login.signup.button">회원가입</a>
            </div>
            
            <!-- 업체 로그인 -->
            <div class="company-login-link" style="margin-top: 20px; text-align: center; padding: 15px; background: #f8f9ff; border-radius: 8px;">
                <a th:href="@{/crm/crm_login}" style="color: #667eea; text-decoration: none; font-weight: 500;">
                    업체 회원이신가요? → 업체 로그인
                </a>
            </div>
        </div>
    </div>

    <!-- 공통 JavaScript -->
    <script src="/resources/js/i18n.js"></script>
    <!-- Login 전용 JavaScript -->
    <script>
        document.getElementById('login-form').addEventListener('submit', async function(e) {
            e.preventDefault();

            const email = document.getElementById('email').value;
            const password = document.getElementById('password').value;

            try {
                const response = await fetch('/api/user/login', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({ email, password })
                });

                const result = await response.json();

                if (result.success) {
                    window.location.href = result.redirectUrl || '/main';
                } else {
                    document.getElementById('email-error').textContent = result.message || '로그인에 실패했습니다.';
                }
            } catch (error) {
                console.error('Error:', error);
                document.getElementById('email-error').textContent = '로그인 처리 중 오류가 발생했습니다.';
            }
        });
    </script>
    <script src="/resources/js/login.js"></script>
    
        <!-- 푸터 -->
    <div th:replace="common/footer :: footer"></div>
</body>
</html>
