<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <title>즐겨찾기</title>
    <link rel="stylesheet" href="/resources/css/favorite.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
</head>
<body>
    <div th:replace="~{common/header :: header}"></div>

<div class="favorite-container">
    <!-- 상단 제목 섹션 -->
    <div class="favorite-header">
        <div class="favorite-icon">
            <i class="fas fa-heart"></i>
        </div>
        <h1 class="favorite-title">즐겨찾기</h1>
    </div>

    <!-- 즐겨찾기 목록 -->
    <div class="favorite-list">
        <div id="favorites-content">
            <!-- JavaScript로 내용이 채워집니다 -->
        </div>
    </div>
</div>

<!-- 상세보기 모달 -->
<div id="detailModal" class="modal">
    <div class="modal-content">
        <span class="close" title="닫기">&times;</span>
        <div id="modalBody">
            <!-- 상세 내용이 여기에 동적으로 로드됩니다 -->
        </div>
    </div>
</div>

<script src="/resources/crm/js/includeHTML.js"></script>
<script src="/resources/js/favorite.js"></script>
<div data-include="/common/footer.html"></div>

<!-- 서버 데이터를 JavaScript로 전달 -->
<script>
    // 서버에서 전달된 데이터를 JavaScript에서 사용할 수 있도록 설정
    // HTML에서는 JSP 문법을 사용할 수 없으므로 API 호출로 대체
    window.serverData = {
        favorites: []
    };
</script>

<script>
    document.addEventListener('DOMContentLoaded', function() {
        includeHTML();
        
        // 서버 데이터 로드
        loadFavorites();
    });
    
    // 즐겨찾기 데이터 로드
    async function loadFavorites() {
        try {
            const response = await fetch('/api/favorites');
            if (response.ok) {
                const favorites = await response.json();
                renderFavorites(favorites);
            } else {
                renderEmptyFavorites();
            }
        } catch (error) {
            console.error('즐겨찾기 데이터 로드 중 오류:', error);
            renderEmptyFavorites();
        }
    }
    
    // 즐겨찾기 목록 렌더링
    function renderFavorites(favorites) {
        const container = document.getElementById('favorites-content');
        
        if (!favorites || favorites.length === 0) {
            renderEmptyFavorites();
            return;
        }
        
        container.innerHTML = favorites.map((favorite, index) => `
            <div class="favorite-item" data-id="${favorite.id}" data-hospital="${favorite.name}">
                <div class="item-banner">
                    <span class="day-number">${index + 1}</span>
                </div>
                <div class="item-content">
                    <div class="item-info">
                        <h3 class="hospital-name">${favorite.name}</h3>
                        <div class="hospital-details">
                            <p class="hospital-address">
                                <i class="fas fa-map-marker-alt"></i>
                                ${favorite.address || '주소 정보 없음'}
                            </p>
                            <p class="hospital-phone">
                                <i class="fas fa-phone"></i>
                                ${favorite.phone || '전화번호 정보 없음'}
                            </p>
                            <p class="hospital-hours">
                                <i class="fas fa-clock"></i>
                                운영시간 정보 없음
                            </p>
                        </div>
                        <div class="hospital-tags">
                            <span class="tag">${favorite.region || ''}</span>
                            <span class="tag">${favorite.subregion || ''}</span>
                            ${favorite.category ? `<span class="tag">${favorite.category}</span>` : ''}
                        </div>
                    </div>
                </div>
                <div class="item-actions">
                    <button class="btn-detail" onclick="showDetail(${favorite.id})">상세보기</button>
                    <button class="btn-remove" title="삭제">
                        <i class="fas fa-trash"></i>
                    </button>
                </div>
            </div>
        `).join('');
    }
    
    // 빈 즐겨찾기 상태 렌더링
    function renderEmptyFavorites() {
        const container = document.getElementById('favorites-content');
        container.innerHTML = `
            <div class="empty-favorites">
                <div class="empty-icon">
                    <i class="fas fa-heart"></i>
                    <i class="fas fa-plus empty-plus"></i>
                </div>
                <div class="empty-content">
                    <h3>아직 즐겨찾기한 병원이 없습니다</h3>
                    <p class="empty-description">마음에 드는 병원을 찾아서 즐겨찾기에 추가해보세요!</p>
                </div>
                <div class="empty-actions">
                    <a href="/main" class="btn-primary">병원 찾아보기</a>
                </div>
            </div>
        `;
    }
</script>
    <!-- 푸터 -->
    <div th:replace="~{common/footer :: footer}"></div>
</body>
</html>
