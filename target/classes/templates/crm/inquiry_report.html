<!DOCTYPE html>
<html lang="ko" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>문의/신고 접수 - 힝거 피부과</title>
    
    <!-- CSS 파일들 -->
    <link rel="stylesheet" href="/crm/css/admin_sidebar.css">
    <link rel="stylesheet" href="/crm/css/admin_header.css">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    
    <style>
        /* 기본 리셋 */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif !important;
            background-color: #f8f9fa !important;
            margin: 0 !important;
            padding: 0 !important;
            display: block !important;
            min-height: 100vh !important;
        }
        
        /* 메인 컨테이너 */
        .report-dashboard-container {
            display: flex !important;
            min-height: 100vh !important;
            background-color: #f8f9fa !important;
        }
       
        /* 메인 콘텐츠 */
        .report-main-content {
            padding: 0 30px 30px 30px !important;
            margin-left: 290px;
        }
        
        .report-page-title {
            font-size: 28px !important;
            font-weight: bold !important;
            color: #2c3e50 !important;
            margin-bottom: 30px !important;
        }
        
        /* 필터 및 검색 영역 */
        .report-filter-section {
            background: white !important;
            border-radius: 12px !important;
            padding: 20px !important;
            margin-bottom: 20px !important;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1) !important;
        }
        
        .report-filter-row {
            display: flex !important;
            gap: 20px !important;
            align-items: center !important;
            flex-wrap: wrap !important;
        }
        
        .report-filter-group {
            display: flex !important;
            align-items: center !important;
            gap: 10px !important;
        }
        
        .report-filter-label {
            font-size: 14px !important;
            font-weight: 600 !important;
            color: #2c3e50 !important;
        }
        
        .report-filter-select {
            padding: 8px 12px !important;
            border: 1px solid #ddd !important;
            border-radius: 6px !important;
            font-size: 14px !important;
            background: white !important;
        }
        
        .report-date-input {
            padding: 8px 12px !important;
            border: 1px solid #ddd !important;
            border-radius: 6px !important;
            font-size: 14px !important;
        }
        
        .report-search-btn {
            padding: 8px 16px !important;
            background: #3498db !important;
            color: white !important;
            border: none !important;
            border-radius: 6px !important;
            font-size: 14px !important;
            cursor: pointer !important;
            transition: background-color 0.3s !important;
        }
        
        .report-search-btn:hover {
            background: #2980b9 !important;
        }
        
        /* 문의/신고 목록 */
        .report-list-section {
            background: white !important;
            border-radius: 12px !important;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1) !important;
            overflow: hidden !important;
        }
        
        .report-list-header {
            padding: 20px !important;
            border-bottom: 1px solid #eee !important;
            display: flex !important;
            justify-content: space-between !important;
            align-items: center !important;
        }
        
        .report-list-title {
            font-size: 18px !important;
            font-weight: 600 !important;
            color: #2c3e50 !important;
        }
        
        .report-list-count {
            font-size: 14px !important;
            color: #7f8c8d !important;
        }
        
        .report-list-content {
            max-height: 600px !important;
            overflow-y: auto !important;
        }
        
        .report-item {
            padding: 20px !important;
            border-bottom: 1px solid #f0f0f0 !important;
            cursor: pointer !important;
            transition: background-color 0.2s !important;
        }
        
        .report-item:hover {
            background-color: #f8f9fa !important;
        }
        
        .report-item:last-child {
            border-bottom: none !important;
        }
        
        .report-item-header {
            display: flex !important;
            justify-content: space-between !important;
            align-items: flex-start !important;
            margin-bottom: 12px !important;
        }
        
        .report-item-info {
            flex: 1 !important;
        }
        
        .report-item-title {
            font-size: 16px !important;
            font-weight: 600 !important;
            color: #2c3e50 !important;
            margin-bottom: 4px !important;
        }
        
        .report-item-meta {
            display: flex !important;
            gap: 15px !important;
            font-size: 12px !important;
            color: #7f8c8d !important;
        }
        
        .report-item-status {
            display: flex !important;
            align-items: center !important;
            gap: 8px !important;
        }
        
        .report-status-badge {
            padding: 4px 8px !important;
            border-radius: 12px !important;
            font-size: 11px !important;
            font-weight: 600 !important;
        }
        
        .report-status-badge.pending {
            background: #f39c12 !important;
            color: white !important;
        }
        
        .report-status-badge.processing {
            background: #3498db !important;
            color: white !important;
        }
        
        .report-status-badge.resolved {
            background: #27ae60 !important;
            color: white !important;
        }
        
        .report-status-badge.rejected {
            background: #e74c3c !important;
            color: white !important;
        }
        
        .report-priority-badge {
            padding: 2px 6px !important;
            border-radius: 8px !important;
            font-size: 10px !important;
            font-weight: 600 !important;
        }
        
        .report-priority-badge.high {
            background: #e74c3c !important;
            color: white !important;
        }
        
        .report-priority-badge.medium {
            background: #f39c12 !important;
            color: white !important;
        }
        
        .report-priority-badge.low {
            background: #95a5a6 !important;
            color: white !important;
        }
        
        .report-item-content {
            margin-bottom: 12px !important;
        }
        
        .report-item-description {
            font-size: 14px !important;
            color: #555 !important;
            line-height: 1.5 !important;
            display: -webkit-box !important;
            -webkit-line-clamp: 2 !important;
            -webkit-box-orient: vertical !important;
            overflow: hidden !important;
        }
        
        .report-item-footer {
            display: flex !important;
            justify-content: space-between !important;
            align-items: center !important;
        }
        
        .report-item-actions {
            display: flex !important;
            gap: 8px !important;
        }
        
        .report-action-btn {
            padding: 6px 12px !important;
            border: 1px solid #ddd !important;
            border-radius: 4px !important;
            background: white !important;
            color: #2c3e50 !important;
            font-size: 12px !important;
            cursor: pointer !important;
            transition: all 0.3s !important;
        }
        
        .report-action-btn:hover {
            background: #f8f9fa !important;
        }
        
        .report-action-btn.primary {
            background: #3498db !important;
            color: white !important;
            border-color: #3498db !important;
        }
        
        .report-action-btn.primary:hover {
            background: #2980b9 !important;
        }
        
        .report-action-btn.danger {
            background: #e74c3c !important;
            color: white !important;
            border-color: #e74c3c !important;
        }
        
        .report-action-btn.danger:hover {
            background: #c0392b !important;
        }
        
        .report-item-date {
            font-size: 12px !important;
            color: #7f8c8d !important;
        }
        
        /* 반응형 디자인 */
        @media (max-width: 768px) {
            .report-dashboard-container {
                flex-direction: column !important;
            }
            
            .report-sidebar-area {
                width: 100% !important;
                padding: 10px !important;
                position: relative !important;
                height: auto !important;
            }
            
            .report-main-content-area {
                margin-left: 0 !important;
            }
            
            .report-search-input {
                width: 200px !important;
            }
            
            .report-filter-row {
                flex-direction: column !important;
                align-items: stretch !important;
            }
            
            .report-filter-group {
                justify-content: space-between !important;
            }
            
            .report-item-header {
                flex-direction: column !important;
                align-items: flex-start !important;
            }
            
            .report-item-footer {
                flex-direction: column !important;
                align-items: flex-start !important;
                gap: 10px !important;
            }
        }
    </style>
</head>
<body>
    <div class="dashboard-container">
        <!-- 사이드바 -->
        <div th:replace="common/admin_sidebar :: admin_sidebar"></div>
        
        <!-- 메인 콘텐츠 -->
        <div class="admin-content">
            <!-- 헤더 -->
            <div th:replace="common/admin_header :: admin_header"></div>
            
            <!-- 메인 콘텐츠 -->
            <div class="report-main-content">
                <h2 class="report-page-title">문의/신고 접수</h2>
                
                <!-- 필터 및 검색 영역 -->
                <div class="report-filter-section">
                    <div class="report-filter-row">
                        <div class="report-filter-group">
                            <label class="report-filter-label">유형:</label>
                            <select class="report-filter-select" id="typeFilter">
                                <option value="all">전체</option>
                                <option value="inquiry">문의</option>
                                <option value="report">신고</option>
                            </select>
                        </div>
                        
                        <div class="report-filter-group">
                            <label class="report-filter-label">상태:</label>
                            <select class="report-filter-select" id="statusFilter">
                                <option value="all">전체</option>
                                <option value="pending">대기중</option>
                                <option value="processing">처리중</option>
                                <option value="resolved">완료</option>
                                <option value="rejected">반려</option>
                            </select>
                        </div>
                        
                        <div class="report-filter-group">
                            <label class="report-filter-label">우선순위:</label>
                            <select class="report-filter-select" id="priorityFilter">
                                <option value="all">전체</option>
                                <option value="high">높음</option>
                                <option value="medium">보통</option>
                                <option value="low">낮음</option>
                            </select>
                        </div>
                        
                        <div class="report-filter-group">
                            <label class="report-filter-label">기간:</label>
                            <input type="date" class="report-date-input" id="startDate">
                            <span>~</span>
                            <input type="date" class="report-date-input" id="endDate">
                        </div>
                        
                        <button class="report-search-btn" onclick="filterReports()">
                            <i class="fas fa-search"></i> 검색
                        </button>
                    </div>
                </div>
                
                <!-- 문의/신고 목록 -->
                <div class="report-list-section">
                    <div class="report-list-header">
                        <div>
                            <h3 class="report-list-title">문의/신고 목록</h3>
                            <div class="report-list-count">총 <span id="totalCount">12</span>건</div>
                        </div>
                    </div>
                    
                    <div class="report-list-content">
                        <div class="report-item" data-id="1" data-type="inquiry" data-status="pending" data-priority="high">
                            <div class="report-item-header">
                                <div class="report-item-info">
                                    <div class="report-item-title">시술 후 부작용 문의</div>
                                    <div class="report-item-meta">
                                        <span>신고자: 김민수</span>
                                        <span>연락처: 010-1234-5678</span>
                                        <span>이메일: kim@example.com</span>
                                    </div>
                                </div>
                                <div class="report-item-status">
                                    <span class="report-status-badge pending">대기중</span>
                                    <span class="report-priority-badge high">높음</span>
                                </div>
                            </div>
                            <div class="report-item-content">
                                <div class="report-item-description">
                                    브이라인 리프팅 시술을 받은 후 얼굴이 부어오르고 통증이 있습니다. 정상적인 반응인지 확인하고 싶습니다.
                                </div>
                            </div>
                            <div class="report-item-footer">
                                <div class="report-item-actions">
                                    <button class="report-action-btn primary" onclick="viewDetail(1)">상세보기</button>
                                    <button class="report-action-btn" onclick="startProcessing(1)">처리시작</button>
                                    <button class="report-action-btn danger" onclick="rejectReport(1)">반려</button>
                                </div>
                                <div class="report-item-date">2024-01-15 14:30</div>
                            </div>
                        </div>
                        
                        <div class="report-item" data-id="2" data-type="report" data-status="processing" data-priority="medium">
                            <div class="report-item-header">
                                <div class="report-item-info">
                                    <div class="report-item-title">의료진 태도 문제 신고</div>
                                    <div class="report-item-meta">
                                        <span>신고자: 이영희</span>
                                        <span>연락처: 010-2345-6789</span>
                                        <span>이메일: lee@example.com</span>
                                    </div>
                                </div>
                                <div class="report-item-status">
                                    <span class="report-status-badge processing">처리중</span>
                                    <span class="report-priority-badge medium">보통</span>
                                </div>
                            </div>
                            <div class="report-item-content">
                                <div class="report-item-description">
                                    시술 중 의료진이 불친절하고 무성의한 태도로 시술을 진행했습니다. 환자에 대한 기본적인 예의가 부족했습니다.
                                </div>
                            </div>
                            <div class="report-item-footer">
                                <div class="report-item-actions">
                                    <button class="report-action-btn primary" onclick="viewDetail(2)">상세보기</button>
                                    <button class="report-action-btn" onclick="completeProcessing(2)">처리완료</button>
                                </div>
                                <div class="report-item-date">2024-01-14 16:45</div>
                            </div>
                        </div>
                        
                        <div class="report-item" data-id="3" data-type="inquiry" data-status="resolved" data-priority="low">
                            <div class="report-item-header">
                                <div class="report-item-info">
                                    <div class="report-item-title">예약 변경 요청</div>
                                    <div class="report-item-meta">
                                        <span>신고자: 박준호</span>
                                        <span>연락처: 010-3456-7890</span>
                                        <span>이메일: park@example.com</span>
                                    </div>
                                </div>
                                <div class="report-item-status">
                                    <span class="report-status-badge resolved">완료</span>
                                    <span class="report-priority-badge low">낮음</span>
                                </div>
                            </div>
                            <div class="report-item-content">
                                <div class="report-item-description">
                                    개인 사정으로 인해 예약된 시술 일정을 다음 주로 변경하고 싶습니다. 가능한지 확인 부탁드립니다.
                                </div>
                            </div>
                            <div class="report-item-footer">
                                <div class="report-item-actions">
                                    <button class="report-action-btn primary" onclick="viewDetail(3)">상세보기</button>
                                </div>
                                <div class="report-item-date">2024-01-13 10:20</div>
                            </div>
                        </div>
                        
                        <div class="report-item" data-id="4" data-type="report" data-status="rejected" data-priority="medium">
                            <div class="report-item-header">
                                <div class="report-item-info">
                                    <div class="report-item-title">시설 청결도 문제 신고</div>
                                    <div class="report-item-meta">
                                        <span>신고자: 최수진</span>
                                        <span>연락처: 010-4567-8901</span>
                                        <span>이메일: choi@example.com</span>
                                    </div>
                                </div>
                                <div class="report-item-status">
                                    <span class="report-status-badge rejected">반려</span>
                                    <span class="report-priority-badge medium">보통</span>
                                </div>
                            </div>
                            <div class="report-item-content">
                                <div class="report-item-description">
                                    병원 내부 시설이 불결하고 위생상 문제가 있다고 생각됩니다. 정기적인 청소와 소독이 필요합니다.
                                </div>
                            </div>
                            <div class="report-item-footer">
                                <div class="report-item-actions">
                                    <button class="report-action-btn primary" onclick="viewDetail(4)">상세보기</button>
                                </div>
                                <div class="report-item-date">2024-01-12 09:15</div>
                            </div>
                        </div>
                        
                        <div class="report-item" data-id="5" data-type="inquiry" data-status="pending" data-priority="high">
                            <div class="report-item-header">
                                <div class="report-item-info">
                                    <div class="report-item-title">시술 비용 환불 요청</div>
                                    <div class="report-item-meta">
                                        <span>신고자: 정다은</span>
                                        <span>연락처: 010-5678-9012</span>
                                        <span>이메일: jung@example.com</span>
                                    </div>
                                </div>
                                <div class="report-item-status">
                                    <span class="report-status-badge pending">대기중</span>
                                    <span class="report-priority-badge high">높음</span>
                                </div>
                            </div>
                            <div class="report-item-content">
                                <div class="report-item-description">
                                    시술 결과가 만족스럽지 않아 환불을 요청합니다. 계약서에 명시된 환불 정책에 따라 처리해주세요.
                                </div>
                            </div>
                            <div class="report-item-footer">
                                <div class="report-item-actions">
                                    <button class="report-action-btn primary" onclick="viewDetail(5)">상세보기</button>
                                    <button class="report-action-btn" onclick="startProcessing(5)">처리시작</button>
                                    <button class="report-action-btn danger" onclick="rejectReport(5)">반려</button>
                                </div>
                                <div class="report-item-date">2024-01-11 15:30</div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- JavaScript -->
    <script th:inline="javascript">
        // 문의/신고 접수 페이지에서 사이드바 활성 상태 설정
        document.addEventListener('DOMContentLoaded', function() {
            // 모든 nav-link에서 active 클래스 제거
            const allNavLinks = document.querySelectorAll('.nav-link');
            allNavLinks.forEach(link => link.classList.remove('active'));
            
            // 문의/신고 접수 링크에 active 클래스 추가
            const sidebarType = /*[[${sidebarType}]]*/ 'admin';
            const inquiryReportPath = sidebarType === 'admin' ? '/admin/inquiry-report' : '/company/inquiry-report';
            const inquiryReportLink = document.querySelector('a[href="' + inquiryReportPath + '"]');
            if (inquiryReportLink) {
                inquiryReportLink.classList.add('active');
            }
        });
        
        // 필터링 기능
        function filterReports() {
            const typeFilter = document.getElementById('typeFilter').value;
            const statusFilter = document.getElementById('statusFilter').value;
            const priorityFilter = document.getElementById('priorityFilter').value;
            const startDate = document.getElementById('startDate').value;
            const endDate = document.getElementById('endDate').value;
            
            const reportItems = document.querySelectorAll('.report-item');
            let visibleCount = 0;
            
            reportItems.forEach(item => {
                const itemType = item.getAttribute('data-type');
                const itemStatus = item.getAttribute('data-status');
                const itemPriority = item.getAttribute('data-priority');
                const itemDate = item.querySelector('.report-item-date').textContent.split(' ')[0];
                
                let show = true;
                
                // 유형 필터
                if (typeFilter !== 'all' && itemType !== typeFilter) {
                    show = false;
                }
                
                // 상태 필터
                if (statusFilter !== 'all' && itemStatus !== statusFilter) {
                    show = false;
                }
                
                // 우선순위 필터
                if (priorityFilter !== 'all' && itemPriority !== priorityFilter) {
                    show = false;
                }
                
                // 날짜 필터
                if (startDate && itemDate < startDate) {
                    show = false;
                }
                if (endDate && itemDate > endDate) {
                    show = false;
                }
                
                if (show) {
                    item.style.display = 'block';
                    visibleCount++;
                } else {
                    item.style.display = 'none';
                }
            });
            
            // 총 개수 업데이트
            document.getElementById('totalCount').textContent = visibleCount;
        }
        
        // 상세보기
        function viewDetail(id) {
            const sidebarType = /*[[${sidebarType}]]*/ 'admin';
            const detailPath = sidebarType === 'admin' 
                ? '/admin/inquiry-report/detail/' + id 
                : '/company/inquiry-report/detail/' + id;
            window.location.href = detailPath;
        }
        
        // 처리 시작
        function startProcessing(id) {
            if (confirm('이 문의/신고를 처리 시작하시겠습니까?')) {
                // 상태 변경
                const item = document.querySelector(`[data-id="${id}"]`);
                const statusBadge = item.querySelector('.report-status-badge');
                statusBadge.textContent = '처리중';
                statusBadge.className = 'report-status-badge processing';
                item.setAttribute('data-status', 'processing');
                
                // 버튼 변경
                const actions = item.querySelector('.report-item-actions');
                actions.innerHTML = `
                    <button class="report-action-btn primary" onclick="viewDetail(${id})">상세보기</button>
                    <button class="report-action-btn" onclick="completeProcessing(${id})">처리완료</button>
                `;
                
                alert('처리가 시작되었습니다.');
            }
        }
        
        // 처리 완료
        function completeProcessing(id) {
            if (confirm('이 문의/신고를 완료 처리하시겠습니까?')) {
                // 상태 변경
                const item = document.querySelector(`[data-id="${id}"]`);
                const statusBadge = item.querySelector('.report-status-badge');
                statusBadge.textContent = '완료';
                statusBadge.className = 'report-status-badge resolved';
                item.setAttribute('data-status', 'resolved');
                
                // 버튼 변경
                const actions = item.querySelector('.report-item-actions');
                actions.innerHTML = `
                    <button class="report-action-btn primary" onclick="viewDetail(${id})">상세보기</button>
                `;
                
                alert('처리가 완료되었습니다.');
            }
        }
        
        // 반려
        function rejectReport(id) {
            if (confirm('이 문의/신고를 반려하시겠습니까?')) {
                // 상태 변경
                const item = document.querySelector(`[data-id="${id}"]`);
                const statusBadge = item.querySelector('.report-status-badge');
                statusBadge.textContent = '반려';
                statusBadge.className = 'report-status-badge rejected';
                item.setAttribute('data-status', 'rejected');
                
                // 버튼 변경
                const actions = item.querySelector('.report-item-actions');
                actions.innerHTML = `
                    <button class="report-action-btn primary" onclick="viewDetail(${id})">상세보기</button>
                `;
                
                alert('반려 처리되었습니다.');
            }
        }
        
        // 초기화
        document.addEventListener('DOMContentLoaded', function() {
            // 오늘 날짜를 기본값으로 설정
            const today = new Date().toISOString().split('T')[0];
            document.getElementById('endDate').value = today;
            
            // 30일 전을 시작 날짜로 설정
            const thirtyDaysAgo = new Date();
            thirtyDaysAgo.setDate(thirtyDaysAgo.getDate() - 30);
            document.getElementById('startDate').value = thirtyDaysAgo.toISOString().split('T')[0];
        });
    </script>
</body>
</html>
