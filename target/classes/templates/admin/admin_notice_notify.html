<!DOCTYPE html>
<html lang="ko" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>공지사항 & 알림 관리 - HealnGo Admin</title>
    <link rel="stylesheet" href="/crm/css/admin_sidebar.css">
    <link rel="stylesheet" href="/crm/css/admin_header.css">
    <link rel="stylesheet" href="/crm/css/admin_notice_notify.css">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <style>
        /* 기본 레이아웃 */
        body {
            margin: 0;
            padding: 0;
            background-color: #f8f9fa !important;
        }
        
        .dashboard-container {
            display: flex;
            min-height: 100vh;
            background-color: #f8f9fa;
        }
        
        .main-content {
            flex: 1;
            margin-left: 290px; /* 사이드바 너비(250px) + margin(40px) */
        }
        
        .admin-page-content {
            padding: 20px;
            background-color: #f8f9fa;
            min-height: 100vh;
        }
    </style>
</head>
<body>
    <div class="dashboard-container">
        <!-- 사이드바 -->
        <div th:replace="~{common/admin_sidebar :: admin_sidebar}"></div>
        
        <!-- 메인 콘텐츠 -->
        <div class="main-content">
            <!-- 헤더 -->
            <div th:replace="~{common/admin_header :: admin_header}"></div>

            <!-- 페이지 컨텐츠 -->
            <div class="admin-page-content">
                <!-- 페이지 헤더 -->
                <div class="page-header">
                    <h1 class="page-title">공지사항 & 알림 관리</h1>
                    <div class="page-actions">
                        <button class="btn btn-primary" onclick="openNoticeModal()">
                            <i class="fas fa-plus"></i>
                            공지사항 작성
                        </button>
                        <button class="btn btn-secondary" onclick="openNotifyModal()">
                            <i class="fas fa-bell"></i>
                            알림 전송
                        </button>
                    </div>
                </div>

                <!-- 탭 메뉴 -->
                <div class="tab-menu">
                    <button class="tab-btn active" onclick="switchTab('notice')">
                        <i class="fas fa-bullhorn"></i>
                        공지사항
                    </button>
                    <button class="tab-btn" onclick="switchTab('notify')">
                        <i class="fas fa-bell"></i>
                        알림 내역
                    </button>
                </div>

                <!-- 공지사항 탭 콘텐츠 -->
                <div id="noticeTab" class="tab-content active">
                    <!-- 필터 및 검색 -->
                    <div class="filters-section">
                        <div class="search-bar">
                            <div class="search-input-wrapper">
                                <i class="fas fa-search search-icon"></i>
                                <input type="text" placeholder="제목, 내용으로 검색..." class="search-input" id="noticeSearchInput" onkeyup="searchNotices()">
                            </div>
                            <button type="button" class="btn btn-search">
                                검색
                            </button>
                        </div>
                        
                        <div class="filter-controls">
                            <select class="filter-select" id="noticeStatusFilter" onchange="filterNotices()">
                                <option value="">전체 상태</option>
                                <option value="active">게시중</option>
                                <option value="scheduled">예약</option>
                                <option value="inactive">비활성</option>
                            </select>
                            
                            <select class="filter-select" id="noticeTypeFilter" onchange="filterNotices()">
                                <option value="">전체 유형</option>
                                <option value="general">일반</option>
                                <option value="important">중요</option>
                                <option value="urgent">긴급</option>
                            </select>
                        </div>
                    </div>

                    <!-- 공지사항 목록 -->
                    <div class="notice-list">
                        <div class="notice-item" data-status="active" data-type="important">
                            <div class="notice-badge badge-important">중요</div>
                            <div class="notice-content">
                                <h3 class="notice-title">시스템 점검 안내</h3>
                                <p class="notice-description">2024년 10월 15일 새벽 2시~4시 시스템 점검이 예정되어 있습니다.</p>
                                <div class="notice-meta">
                                    <span class="notice-author">관리자</span>
                                    <span class="notice-date">2024-10-09 14:30</span>
                                    <span class="notice-views"><i class="fas fa-eye"></i> 1,234</span>
                                </div>
                            </div>
                            <div class="notice-status">
                                <span class="status-badge status-active">게시중</span>
                            </div>
                            <div class="notice-actions">
                                <button class="btn-action btn-edit" onclick="editNotice(this)" title="수정">
                                    <i class="fas fa-edit"></i>
                                </button>
                                <button class="btn-action btn-delete" onclick="deleteNotice(this)" title="삭제">
                                    <i class="fas fa-trash"></i>
                                </button>
                            </div>
                        </div>

                        <div class="notice-item" data-status="active" data-type="general">
                            <div class="notice-badge badge-general">일반</div>
                            <div class="notice-content">
                                <h3 class="notice-title">신규 서비스 출시 안내</h3>
                                <p class="notice-description">새로운 예약 시스템이 출시되었습니다. 더욱 편리한 예약 관리를 경험해보세요.</p>
                                <div class="notice-meta">
                                    <span class="notice-author">관리자</span>
                                    <span class="notice-date">2024-10-08 10:00</span>
                                    <span class="notice-views"><i class="fas fa-eye"></i> 856</span>
                                </div>
                            </div>
                            <div class="notice-status">
                                <span class="status-badge status-active">게시중</span>
                            </div>
                            <div class="notice-actions">
                                <button class="btn-action btn-edit" onclick="editNotice(this)" title="수정">
                                    <i class="fas fa-edit"></i>
                                </button>
                                <button class="btn-action btn-delete" onclick="deleteNotice(this)" title="삭제">
                                    <i class="fas fa-trash"></i>
                                </button>
                            </div>
                        </div>

                        <div class="notice-item" data-status="scheduled" data-type="urgent">
                            <div class="notice-badge badge-urgent">긴급</div>
                            <div class="notice-content">
                                <h3 class="notice-title">긴급 보안 업데이트 예정</h3>
                                <p class="notice-description">보안 강화를 위한 긴급 업데이트가 10월 20일 시행됩니다.</p>
                                <div class="notice-meta">
                                    <span class="notice-author">관리자</span>
                                    <span class="notice-date">2024-10-07 16:45</span>
                                    <span class="notice-views"><i class="fas fa-eye"></i> 2,103</span>
                                </div>
                            </div>
                            <div class="notice-status">
                                <span class="status-badge status-scheduled">예약</span>
                            </div>
                            <div class="notice-actions">
                                <button class="btn-action btn-edit" onclick="editNotice(this)" title="수정">
                                    <i class="fas fa-edit"></i>
                                </button>
                                <button class="btn-action btn-delete" onclick="deleteNotice(this)" title="삭제">
                                    <i class="fas fa-trash"></i>
                                </button>
                            </div>
                        </div>
                    </div>

                    <!-- 페이지네이션 -->
                    <div class="pagination">
                        <button class="pagination-btn">
                            <i class="fas fa-chevron-left"></i>
                        </button>
                        <button class="pagination-btn active">1</button>
                        <button class="pagination-btn">2</button>
                        <button class="pagination-btn">3</button>
                        <button class="pagination-btn">
                            <i class="fas fa-chevron-right"></i>
                        </button>
                    </div>
                </div>

                <!-- 알림 내역 탭 콘텐츠 -->
                <div id="notifyTab" class="tab-content">
                    <!-- 필터 및 검색 -->
                    <div class="filters-section">
                        <div class="search-bar">
                            <div class="search-input-wrapper">
                                <i class="fas fa-search search-icon"></i>
                                <input type="text" placeholder="내용, 수신자로 검색..." class="search-input" id="notifySearchInput" onkeyup="searchNotifications()">
                            </div>
                            <button type="button" class="btn btn-search">
                                검색
                            </button>
                        </div>
                        
                        <div class="filter-controls">
                            <select class="filter-select" id="notifyTypeFilter" onchange="filterNotifications()">
                                <option value="">전체 유형</option>
                                <option value="all">전체 발송</option>
                                <option value="users">사용자</option>
                                <option value="companies">업체</option>
                            </select>
                            
                            <input type="date" class="filter-date" id="notifyDateFrom" placeholder="시작일" onchange="filterNotifications()">
                            <input type="date" class="filter-date" id="notifyDateTo" placeholder="종료일" onchange="filterNotifications()">
                        </div>
                    </div>

                    <!-- 알림 통계 -->
                    <div class="notify-stats">
                        <div class="stat-card">
                            <div class="stat-icon">
                                <i class="fas fa-paper-plane"></i>
                            </div>
                            <div class="stat-content">
                                <h3 class="stat-number">1,234</h3>
                                <p class="stat-label">총 발송</p>
                            </div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-icon">
                                <i class="fas fa-check-circle"></i>
                            </div>
                            <div class="stat-content">
                                <h3 class="stat-number">1,180</h3>
                                <p class="stat-label">전달 완료</p>
                            </div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-icon">
                                <i class="fas fa-clock"></i>
                            </div>
                            <div class="stat-content">
                                <h3 class="stat-number">54</h3>
                                <p class="stat-label">대기중</p>
                            </div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-icon">
                                <i class="fas fa-times-circle"></i>
                            </div>
                            <div class="stat-content">
                                <h3 class="stat-number">12</h3>
                                <p class="stat-label">실패</p>
                            </div>
                        </div>
                    </div>

                    <!-- 알림 목록 -->
                    <div class="notify-list">
                        <div class="notify-item" data-type="all">
                            <div class="notify-icon notify-all">
                                <i class="fas fa-users"></i>
                            </div>
                            <div class="notify-content">
                                <h3 class="notify-title">시스템 점검 안내</h3>
                                <p class="notify-message">금일 새벽 2시~4시 시스템 점검이 예정되어 있습니다.</p>
                                <div class="notify-meta">
                                    <span class="notify-type">전체 발송</span>
                                    <span class="notify-date">2024-10-09 14:30</span>
                                    <span class="notify-recipients">수신: 5,234명</span>
                                </div>
                            </div>
                            <div class="notify-status">
                                <span class="status-badge status-sent">발송완료</span>
                            </div>
                        </div>

                        <div class="notify-item" data-type="users">
                            <div class="notify-icon notify-users">
                                <i class="fas fa-user"></i>
                            </div>
                            <div class="notify-content">
                                <h3 class="notify-title">신규 이벤트 안내</h3>
                                <p class="notify-message">10월 신규 가입 회원 대상 할인 이벤트를 시작합니다.</p>
                                <div class="notify-meta">
                                    <span class="notify-type">사용자</span>
                                    <span class="notify-date">2024-10-08 10:00</span>
                                    <span class="notify-recipients">수신: 1,234명</span>
                                </div>
                            </div>
                            <div class="notify-status">
                                <span class="status-badge status-sent">발송완료</span>
                            </div>
                        </div>

                        <div class="notify-item" data-type="companies">
                            <div class="notify-icon notify-companies">
                                <i class="fas fa-building"></i>
                            </div>
                            <div class="notify-content">
                                <h3 class="notify-title">정산 일정 안내</h3>
                                <p class="notify-message">10월 정산이 15일에 진행됩니다. 확인 부탁드립니다.</p>
                                <div class="notify-meta">
                                    <span class="notify-type">업체</span>
                                    <span class="notify-date">2024-10-07 09:15</span>
                                    <span class="notify-recipients">수신: 89개 업체</span>
                                </div>
                            </div>
                            <div class="notify-status">
                                <span class="status-badge status-pending">대기중</span>
                            </div>
                        </div>
                    </div>

                    <!-- 페이지네이션 -->
                    <div class="pagination">
                        <button class="pagination-btn">
                            <i class="fas fa-chevron-left"></i>
                        </button>
                        <button class="pagination-btn active">1</button>
                        <button class="pagination-btn">2</button>
                        <button class="pagination-btn">3</button>
                        <button class="pagination-btn">
                            <i class="fas fa-chevron-right"></i>
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- 공지사항 작성/수정 모달 -->
    <div id="noticeModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2>공지사항 작성</h2>
                <span class="close" onclick="closeNoticeModal()">&times;</span>
            </div>
            <form id="noticeForm">
                <div class="form-group">
                    <label for="noticeTitle">제목</label>
                    <input type="text" id="noticeTitle" name="title" placeholder="공지사항 제목을 입력하세요" required>
                </div>
                
                <div class="form-group">
                    <label for="noticeType">유형</label>
                    <select id="noticeType" name="type" required>
                        <option value="general">일반</option>
                        <option value="important">중요</option>
                        <option value="urgent">긴급</option>
                    </select>
                </div>
                
                <div class="form-group">
                    <label for="noticeContent">내용</label>
                    <textarea id="noticeContent" name="content" placeholder="공지사항 내용을 입력하세요" rows="6" required></textarea>
                </div>
                
                <div class="form-row">
                    <div class="form-group">
                        <label for="noticeStartDate">게시 시작일</label>
                        <input type="datetime-local" id="noticeStartDate" name="startDate" required>
                    </div>
                    <div class="form-group">
                        <label for="noticeEndDate">게시 종료일</label>
                        <input type="datetime-local" id="noticeEndDate" name="endDate">
                    </div>
                </div>
                
                <div class="form-group">
                    <label class="checkbox-label">
                        <input type="checkbox" id="noticeTopFixed" name="topFixed" value="true">
                        <span class="checkmark"></span>
                        상단 고정
                    </label>
                </div>
                
                <div class="modal-actions">
                    <button type="button" class="btn-cancel" onclick="closeNoticeModal()">취소</button>
                    <button type="submit" class="btn-save">저장</button>
                </div>
            </form>
        </div>
    </div>

    <!-- 알림 전송 모달 -->
    <div id="notifyModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2>알림 전송</h2>
                <span class="close" onclick="closeNotifyModal()">&times;</span>
            </div>
            <form id="notifyForm">
                <div class="form-group">
                    <label for="notifyTarget">발송 대상</label>
                    <select id="notifyTarget" name="target" required onchange="updateTargetInfo()">
                        <option value="all">전체</option>
                        <option value="users">사용자</option>
                        <option value="companies">업체</option>
                        <option value="custom">직접 선택</option>
                    </select>
                    <small class="form-help" id="targetInfo">전체 사용자 및 업체에 발송됩니다</small>
                </div>
                
                <div class="form-group">
                    <label for="notifyTitle">제목</label>
                    <input type="text" id="notifyTitle" name="title" placeholder="알림 제목을 입력하세요" required>
                </div>
                
                <div class="form-group">
                    <label for="notifyMessage">메시지</label>
                    <textarea id="notifyMessage" name="message" placeholder="알림 메시지를 입력하세요" rows="4" required></textarea>
                    <small class="form-help">최대 200자</small>
                </div>
                
                <div class="form-group">
                    <label for="notifySchedule">발송 시간</label>
                    <select id="notifySchedule" name="schedule" required onchange="toggleScheduleDateTime()">
                        <option value="now">즉시 발송</option>
                        <option value="scheduled">예약 발송</option>
                    </select>
                </div>
                
                <div class="form-group" id="scheduleDateTime" style="display: none;">
                    <label for="notifyDateTime">예약 시간</label>
                    <input type="datetime-local" id="notifyDateTime" name="dateTime">
                </div>
                
                <div class="modal-actions">
                    <button type="button" class="btn-cancel" onclick="closeNotifyModal()">취소</button>
                    <button type="submit" class="btn-save">전송</button>
                </div>
            </form>
        </div>
    </div>

    <script src="/crm/js/admin_notice_notify.js"></script>
</body>
</html>

