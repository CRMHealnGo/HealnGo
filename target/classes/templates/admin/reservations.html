<!DOCTYPE html>
<html lang="ko" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>예약 관리 - HealnGo Admin</title>
    <link rel="stylesheet" href="/crm/css/admin_sidebar.css">
    <link rel="stylesheet" href="/crm/css/admin_header.css">
    <link rel="stylesheet" href="/crm/css/admin_reservations.css">
    <style>
        /* 추가 스타일 오버라이드 */
        body {
            display: block !important;
            background-color: #F4F9FD !important;
        }
    </style>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
</head>
<body>
    <!-- 사이드바 -->
    <div th:replace="common/admin_sidebar :: admin_sidebar"></div>
    
    <!-- 메인 컨텐츠 -->
    <div class="admin-main-content">
        <!-- 헤더 -->
        <div th:replace="common/admin_header :: admin_header"></div>

        <!-- 페이지 컨텐츠 -->
        <div class="admin-page-content">
            <!-- 페이지 헤더 -->
            <div class="page-header">
                <h1 class="page-title">이벤트/프로모션 신청 관리</h1>
                <div class="page-actions">
                    <button class="btn btn-secondary">
                        <i class="fas fa-download"></i>
                        엑셀 다운로드
                    </button>
                </div>
            </div>

            <!-- 통계 카드 -->
            <div class="reservation-stats">
                <div class="stat-card">
                    <div class="stat-icon">
                        <i class="fas fa-file-alt"></i>
                    </div>
                    <div class="stat-content">
                        <h3 class="stat-number">45</h3>
                        <p class="stat-label">총 신청</p>
                    </div>
                </div>
                <div class="stat-card">
                    <div class="stat-icon">
                        <i class="fas fa-clock"></i>
                    </div>
                    <div class="stat-content">
                        <h3 class="stat-number">12</h3>
                        <p class="stat-label">대기중</p>
                    </div>
                </div>
                <div class="stat-card">
                    <div class="stat-icon">
                        <i class="fas fa-check-circle"></i>
                    </div>
                    <div class="stat-content">
                        <h3 class="stat-number">28</h3>
                        <p class="stat-label">승인</p>
                    </div>
                </div>
                <div class="stat-card">
                    <div class="stat-icon">
                        <i class="fas fa-times-circle"></i>
                    </div>
                    <div class="stat-content">
                        <h3 class="stat-number">5</h3>
                        <p class="stat-label">반려</p>
                    </div>
                </div>
            </div>

            <!-- 필터 및 검색 -->
            <div class="filters-section">
                <div class="search-bar">
                    <div class="search-input-wrapper">
                        <i class="fas fa-search search-icon"></i>
                        <input type="text" placeholder="업체명, 이벤트명으로 검색..." class="search-input" 
                               id="searchInput" onkeyup="searchEvents()">
                    </div>
                    <button type="button" class="btn btn-search" onclick="searchEvents()">
                        검색
                    </button>
                </div>
                
                <div class="filter-controls">
                    <select class="filter-select" id="statusFilter" onchange="filterEvents()">
                        <option value="">전체 상태</option>
                        <option value="pending">대기중</option>
                        <option value="approved">승인</option>
                        <option value="rejected">반려</option>
                        <option value="active">진행중</option>
                        <option value="completed">완료</option>
                    </select>
                    
                    <select class="filter-select" id="typeFilter" onchange="filterEvents()">
                        <option value="">전체 유형</option>
                        <option value="event">이벤트</option>
                        <option value="promotion">프로모션</option>
                        <option value="discount">할인</option>
                    </select>
                    
                    <input type="date" class="filter-date" id="dateFrom" placeholder="시작일" onchange="filterEvents()">
                    <input type="date" class="filter-date" id="dateTo" placeholder="종료일" onchange="filterEvents()">
                </div>
            </div>

            <!-- 이벤트/프로모션 신청 목록 -->
            <div class="events-table-container">
                <div class="table-header">
                    <div class="table-info">
                        <span class="total-count">총 <strong>45</strong>건</span>
                    </div>
                    <div class="table-actions">
                        <button class="btn btn-sm btn-secondary" onclick="toggleSelectAll()">
                            전체 선택
                        </button>
                        <button class="btn btn-sm btn-success" onclick="bulkApprove()">
                            선택 승인
                        </button>
                        <button class="btn btn-sm btn-danger" onclick="bulkReject()">
                            선택 반려
                        </button>
                    </div>
                </div>

                <div class="table-wrapper">
                    <table class="events-table">
                        <thead>
                            <tr>
                                <th class="checkbox-column">
                                    <input type="checkbox" id="selectAllCheckbox" onchange="toggleSelectAll()">
                                </th>
                                <th>신청 ID</th>
                                <th>업체명</th>
                                <th>이벤트명</th>
                                <th>유형</th>
                                <th>기간</th>
                                <th>신청일</th>
                                <th>상태</th>
                                <th>액션</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr class="event-row" data-status="pending" data-type="event">
                                <td class="checkbox-column">
                                    <input type="checkbox" class="event-checkbox" value="1">
                                </td>
                                <td class="event-id">E001</td>
                                <td class="company-name">힝거피부과</td>
                                <td class="event-name">가을맞이 레이저 토닝 할인</td>
                                <td class="event-type"><span class="type-badge type-event">이벤트</span></td>
                                <td class="event-period">
                                    <div class="date">2024-10-15 ~ 2024-10-31</div>
                                </td>
                                <td class="apply-date">2024-10-09</td>
                                <td class="event-status">
                                    <span class="status-badge status-pending">대기중</span>
                                </td>
                                <td class="actions">
                                    <div class="action-buttons">
                                        <button class="btn btn-sm btn-info" onclick="viewEventDetail(1)" title="상세보기">
                                            <i class="fas fa-eye"></i>
                                        </button>
                                        <button class="btn btn-sm btn-success" onclick="approveEvent(1)" title="승인">
                                            <i class="fas fa-check"></i>
                                        </button>
                                        <button class="btn btn-sm btn-danger" onclick="rejectEvent(1)" title="반려">
                                            <i class="fas fa-times"></i>
                                        </button>
                                    </div>
                                </td>
                            </tr>
                            
                            <tr class="event-row" data-status="approved" data-type="promotion">
                                <td class="checkbox-column">
                                    <input type="checkbox" class="event-checkbox" value="2">
                                </td>
                                <td class="event-id">E002</td>
                                <td class="company-name">뷰티클리닉</td>
                                <td class="event-name">신규 고객 50% 할인</td>
                                <td class="event-type"><span class="type-badge type-promotion">프로모션</span></td>
                                <td class="event-period">
                                    <div class="date">2024-10-01 ~ 2024-10-30</div>
                                </td>
                                <td class="apply-date">2024-09-28</td>
                                <td class="event-status">
                                    <span class="status-badge status-approved">승인</span>
                                </td>
                                <td class="actions">
                                    <div class="action-buttons">
                                        <button class="btn btn-sm btn-info" onclick="viewEventDetail(2)" title="상세보기">
                                            <i class="fas fa-eye"></i>
                                        </button>
                                        <button class="btn btn-sm btn-warning" onclick="editEvent(2)" title="수정">
                                            <i class="fas fa-edit"></i>
                                        </button>
                                    </div>
                                </td>
                            </tr>
                            
                            <tr class="event-row" data-status="active" data-type="discount">
                                <td class="checkbox-column">
                                    <input type="checkbox" class="event-checkbox" value="3">
                                </td>
                                <td class="event-id">E003</td>
                                <td class="company-name">메디컬센터</td>
                                <td class="event-name">주말 특가 할인</td>
                                <td class="event-type"><span class="type-badge type-discount">할인</span></td>
                                <td class="event-period">
                                    <div class="date">2024-10-05 ~ 2024-10-25</div>
                                </td>
                                <td class="apply-date">2024-10-03</td>
                                <td class="event-status">
                                    <span class="status-badge status-active">진행중</span>
                                </td>
                                <td class="actions">
                                    <div class="action-buttons">
                                        <button class="btn btn-sm btn-info" onclick="viewEventDetail(3)" title="상세보기">
                                            <i class="fas fa-eye"></i>
                                        </button>
                                        <button class="btn btn-sm btn-warning" onclick="editEvent(3)" title="수정">
                                            <i class="fas fa-edit"></i>
                                        </button>
                                        <button class="btn btn-sm btn-danger" onclick="endEvent(3)" title="종료">
                                            <i class="fas fa-stop"></i>
                                        </button>
                                    </div>
                                </td>
                            </tr>
                            
                            <tr class="event-row" data-status="rejected" data-type="event">
                                <td class="checkbox-column">
                                    <input type="checkbox" class="event-checkbox" value="4">
                                </td>
                                <td class="event-id">E004</td>
                                <td class="company-name">스킨케어센터</td>
                                <td class="event-name">초특가 세일</td>
                                <td class="event-type"><span class="type-badge type-event">이벤트</span></td>
                                <td class="event-period">
                                    <div class="date">2024-10-10 ~ 2024-10-20</div>
                                </td>
                                <td class="apply-date">2024-10-08</td>
                                <td class="event-status">
                                    <span class="status-badge status-rejected">반려</span>
                                </td>
                                <td class="actions">
                                    <div class="action-buttons">
                                        <button class="btn btn-sm btn-info" onclick="viewEventDetail(4)" title="상세보기">
                                            <i class="fas fa-eye"></i>
                                        </button>
                                        <button class="btn btn-sm btn-secondary" onclick="deleteEvent(4)" title="삭제">
                                            <i class="fas fa-trash"></i>
                                        </button>
                                    </div>
                                </td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>

            <!-- 페이지네이션 -->
            <div class="pagination-container">
                <div class="pagination-info">
                    <span>페이지 <strong th:text="${currentPage}">1</strong> / <strong th:text="${totalPages}">32</strong></span>
                </div>
                <div class="pagination">
                    <button class="pagination-btn" th:if="${currentPage > 1}" 
                            th:onclick="'goToPage(' + ${currentPage - 1} + ')'">
                        <i class="fas fa-chevron-left"></i>
                    </button>
                    
                    <span th:each="pageNum : ${#numbers.sequence(1, totalPages)}" 
                          th:if="${pageNum >= currentPage - 2 and pageNum <= currentPage + 2}">
                        <button class="pagination-btn" 
                                th:classappend="${pageNum == currentPage} ? 'active'"
                                th:onclick="'goToPage(' + ${pageNum} + ')'"
                                th:text="${pageNum}">1</button>
                    </span>
                    
                    <button class="pagination-btn" th:if="${currentPage < totalPages}" 
                            th:onclick="'goToPage(' + ${currentPage + 1} + ')'">
                        <i class="fas fa-chevron-right"></i>
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- 예약 상세 모달 -->
    <div id="reservationDetailModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3>예약 상세 정보</h3>
                <span class="close" onclick="closeModal('reservationDetailModal')">&times;</span>
            </div>
            <div class="modal-body">
                <div id="reservationDetailContent">
                    <!-- 예약 상세 정보가 여기에 로드됩니다 -->
                </div>
            </div>
        </div>
    </div>

    <!-- 이벤트 상세 보기 모달 -->
    <div id="eventDetailModal" class="modal">
        <div class="modal-content modal-large">
            <div class="modal-header">
                <h2>이벤트 상세 정보</h2>
                <span class="close" onclick="closeEventDetailModal()">&times;</span>
            </div>
            <div class="modal-body">
                <div class="event-detail" id="eventDetailContent">
                    <!-- 상세 정보가 여기에 로드됩니다 -->
                </div>
            </div>
        </div>
    </div>

    <!-- 이벤트 수정 모달 -->
    <div id="editEventModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2>이벤트 수정</h2>
                <span class="close" onclick="closeEditEventModal()">&times;</span>
            </div>
            <form id="editEventForm">
                <input type="hidden" id="editEventId" name="eventId">
                
                <div class="form-group">
                    <label for="editEventName">이벤트명</label>
                    <input type="text" id="editEventName" name="eventName" placeholder="이벤트명을 입력하세요" required>
                </div>
                
                <div class="form-group">
                    <label for="editEventType">유형</label>
                    <select id="editEventType" name="eventType" required>
                        <option value="event">이벤트</option>
                        <option value="promotion">프로모션</option>
                        <option value="discount">할인</option>
                    </select>
                </div>
                
                <div class="form-row">
                    <div class="form-group">
                        <label for="editStartDate">시작일</label>
                        <input type="date" id="editStartDate" name="startDate" required>
                    </div>
                    <div class="form-group">
                        <label for="editEndDate">종료일</label>
                        <input type="date" id="editEndDate" name="endDate" required>
                    </div>
                </div>
                
                <div class="form-group">
                    <label for="editEventDescription">설명</label>
                    <textarea id="editEventDescription" name="description" placeholder="이벤트 설명을 입력하세요" rows="4"></textarea>
                </div>
                
                <div class="modal-actions">
                    <button type="button" class="btn-cancel" onclick="closeEditEventModal()">취소</button>
                    <button type="submit" class="btn-save">저장</button>
                </div>
            </form>
        </div>
    </div>

    <!-- 반려 사유 입력 모달 -->
    <div id="rejectModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2>이벤트 반려</h2>
                <span class="close" onclick="closeRejectModal()">&times;</span>
            </div>
            <form id="rejectForm">
                <input type="hidden" id="rejectEventId" name="eventId">
                
                <div class="form-group">
                    <label for="rejectReason">반려 사유</label>
                    <textarea id="rejectReason" name="reason" placeholder="반려 사유를 입력하세요" rows="5" required></textarea>
                    <small class="form-help">업체에 반려 사유가 전달됩니다.</small>
                </div>
                
                <div class="form-group">
                    <label class="checkbox-label">
                        <input type="checkbox" id="notifyCompany" name="notifyCompany" value="true" checked>
                        <span class="checkmark"></span>
                        업체에 알림 전송
                    </label>
                </div>
                
                <div class="modal-actions">
                    <button type="button" class="btn-cancel" onclick="closeRejectModal()">취소</button>
                    <button type="submit" class="btn-reject">반려 처리</button>
                </div>
            </form>
        </div>
    </div>

    <script src="/crm/js/admin_reservations.js"></script>
</body>
</html>
