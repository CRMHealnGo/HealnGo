<!DOCTYPE html>
<html lang="ko" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>사용자 관리 - HealnGo Admin</title>
    <link rel="stylesheet" href="/crm/css/admin_sidebar.css">
    <link rel="stylesheet" href="/crm/css/admin_header.css">
    <link rel="stylesheet" href="/crm/css/admin_users.css">
    <style>
        /* 추가 스타일 오버라이드 */
        body {
            display: block !important;
            background-color: #F4F9FD !important;
        }
    </style>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
</head>
<body>
    <!-- 사이드바 -->
    <div th:replace="common/admin_sidebar :: admin_sidebar"></div>
    
    <!-- 메인 컨텐츠 -->
    <div class="admin-main-content">
        <!-- 헤더 -->
        <div th:replace="common/admin_header :: admin_header"></div>

        <!-- 페이지 컨텐츠 -->
        <div class="admin-page-content">
            <!-- 페이지 헤더 -->
            <div class="page-header">
                <h1 class="page-title">사용자 관리</h1>
                <div class="page-actions">
                    <button class="btn btn-secondary">
                        <i class="fas fa-download"></i>
                        엑셀 다운로드
                    </button>
                    <button class="btn btn-primary">
                        <i class="fas fa-plus"></i>
                        사용자 추가
                    </button>
                </div>
            </div>

            <!-- 필터 및 검색 -->
            <div class="filters-section">
                <div class="search-bar">
                    <div class="search-input-wrapper">
                        <i class="fas fa-search search-icon"></i>
                        <input type="text" placeholder="사용자명, 이메일로 검색..." class="search-input" 
                               th:value="${search}" id="searchInput">
                    </div>
                    <button type="button" class="btn btn-search" onclick="performSearch()">
                        검색
                    </button>
                </div>
                
                <div class="filter-controls">
                    <select class="filter-select" id="statusFilter">
                        <option value="">전체 상태</option>
                        <option value="active">활성</option>
                        <option value="inactive">비활성</option>
                        <option value="suspended">정지</option>
                    </select>
                    
                    <select class="filter-select" id="sortBy">
                        <option value="joinDate">가입일순</option>
                        <option value="name">이름순</option>
                        <option value="email">이메일순</option>
                    </select>
                    
                    <button class="btn btn-filter" onclick="applyFilters()">
                        <i class="fas fa-filter"></i>
                        필터 적용
                    </button>
                </div>
            </div>

            <!-- 사용자 목록 -->
            <div class="users-table-container">
                <div class="table-header">
                    <div class="table-info">
                        <span class="total-count">총 <strong th:text="${totalUsers}">1,250</strong>명</span>
                    </div>
                    <div class="table-actions">
                        <button class="btn btn-sm btn-secondary" onclick="selectAll()">
                            전체 선택
                        </button>
                        <button class="btn btn-sm btn-danger" onclick="bulkAction('suspend')">
                            선택 정지
                        </button>
                    </div>
                </div>

                <div class="table-wrapper">
                    <table class="users-table">
                        <thead>
                            <tr>
                                <th class="checkbox-column">
                                    <input type="checkbox" id="selectAllCheckbox" onchange="toggleSelectAll()">
                                </th>
                                <th>사용자 ID</th>
                                <th>이름</th>
                                <th>이메일</th>
                                <th>가입일</th>
                                <th>상태</th>
                                <th>신고 횟수</th>
                                <th>액션</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr th:each="user : ${users}" class="user-row">
                                <td class="checkbox-column">
                                    <input type="checkbox" class="user-checkbox" th:value="${user.id}">
                                </td>
                                <td class="user-id" th:text="${user.id}">1</td>
                                <td class="user-name" th:text="${user.name}">김철수</td>
                                <td class="user-email" th:text="${user.email}">kim@example.com</td>
                                <td class="join-date" th:text="${user.joinDate}">2024-01-15</td>
                                <td class="user-status">
                                    <span class="status-badge" 
                                          th:classappend="${user.status == '활성'} ? 'status-active' : 'status-inactive'"
                                          th:text="${user.status}">활성</span>
                                </td>
                                <td class="report-count">
                                    <span class="report-badge" 
                                          th:classappend="${user.reportCount >= 3} ? 'report-high' : (${user.reportCount >= 1} ? 'report-medium' : 'report-low')"
                                          th:text="${user.reportCount}">0</span>
                                </td>
                                <td class="actions">
                                    <div class="action-buttons">
                                        <button class="btn btn-sm btn-info" th:onclick="|viewUser(${user.id})|">
                                            <i class="fas fa-eye"></i>
                                        </button>
                                        <button class="btn btn-sm btn-warning" th:onclick="|editUser(${user.id})|">
                                            <i class="fas fa-edit"></i>
                                        </button>
                                        <button class="btn btn-sm btn-danger" th:onclick="|suspendUser(${user.id})|">
                                            <i class="fas fa-ban"></i>
                                        </button>
                                    </div>
                                </td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>

            <!-- 페이지네이션 -->
            <div class="pagination-container">
                <div class="pagination-info">
                    <span>페이지 <strong th:text="${currentPage}">1</strong> / <strong th:text="${totalPages}">125</strong></span>
                </div>
                <div class="pagination">
                    <button class="pagination-btn" th:if="${currentPage > 1}" 
                            th:onclick="'goToPage(' + ${currentPage - 1} + ')'">
                        <i class="fas fa-chevron-left"></i>
                    </button>
                    
                    <span th:each="pageNum : ${#numbers.sequence(1, totalPages)}" 
                          th:if="${pageNum >= currentPage - 2 and pageNum <= currentPage + 2}">
                        <button class="pagination-btn" 
                                th:classappend="${pageNum == currentPage} ? 'active'"
                                th:onclick="'goToPage(' + ${pageNum} + ')'"
                                th:text="${pageNum}">1</button>
                    </span>
                    
                    <button class="pagination-btn" th:if="${currentPage < totalPages}" 
                            th:onclick="'goToPage(' + ${currentPage + 1} + ')'">
                        <i class="fas fa-chevron-right"></i>
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- 사용자 상세 모달 -->
    <div id="userDetailModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3>사용자 상세 정보</h3>
                <span class="close" onclick="closeModal('userDetailModal')">&times;</span>
            </div>
            <div class="modal-body">
                <div id="userDetailContent">
                    <!-- 사용자 상세 정보가 여기에 로드됩니다 -->
                </div>
            </div>
        </div>
    </div>

    <script src="/crm/js/admin_users.js"></script>
</body>
</html>
